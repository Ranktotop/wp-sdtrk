class Wp_Sdtrk_Catcher_Ga{constructor(e,t){this.localizedData=wp_sdtrk_ga,this.event=e,this.helper=t,this.s_enabled=!1,this.b_enabled=!1,this.pixelLoaded=!1,this.cid=!1,this.gclid=!1,this.validate()}validate(e=2){""!==this.localizedData.pid&&this.event&&(this.get_Cid()&&(this.cid=this.get_Cid()),2!==e&&0!==e||!1===this.helper.has_consent(this.localizedData.b_ci,this.localizedData.b_cs,this.event)||""===this.localizedData.b_e||(this.b_enabled=!0,this.loadPixel()),2!==e&&1!==e||!1===this.helper.has_consent(this.localizedData.s_ci,this.localizedData.s_cs,this.event)||""===this.localizedData.s_e||(this.s_enabled=!0),this.get_Gclid()&&(this.gclid=this.get_Gclid()))}isOngoingBackload(e){var t=!0,a=!1;return"b"!==e||(t=this.pixelLoaded)||(this.validate(0),a=this.pixelLoaded),"s"!==e||(t=this.isEnabled("s"))||(this.validate(1),a=this.isEnabled("s")),!1===t&&!0===a}isEnabled(e){switch(e){case"b":return this.b_enabled;case"s":return this.s_enabled}return!1}catchPageHit(e=2){1!==e&&2!==e||this.sendData("Page",{state:!0}),this.catchEventHit(e)}catchEventHit(e=2){this.event.grabEventName()&&(0!==e&&2!==e||this.fireData("Event",{state:!0}),1!==e&&2!==e||this.sendData("Event",{state:!0}))}catchScrollHit(e,t=2){0!==t&&2!==t||this.fireData("Scroll",{percent:e}),1!==t&&2!==t||this.sendData("Scroll",{percent:e})}catchTimeHit(e,t=2){0!==t&&2!==t||this.fireData("Time",{time:e}),1!==t&&2!==t||this.sendData("Time",{time:e})}catchClickHit(e,t=2){0!==t&&2!==t||this.fireData("Click",{tag:e}),1!==t&&2!==t||this.sendData("Click",{tag:e})}catchVisibilityHit(e,t=2){0!==t&&2!==t||this.fireData("Visibility",{tag:e}),1!==t&&2!==t||this.sendData("Visibility",{tag:e})}loadPixel(){var e,t,a;this.isEnabled("b")&&!this.pixelLoaded&&(this.set_storedCampaign(),window,e=document,t="//www.googletagmanager.com/gtag/js?id="+this.localizedData.pid,a=e.createElement("script"),e=e.getElementsByTagName("script")[0],a.async=1,a.src=t,e.parentNode.insertBefore(a,e),window.dataLayer=window.dataLayer||[],window.gtag=window.gtag||function(){dataLayer.push(arguments)},gtag("js",new Date),gtag("config",this.localizedData.pid,this.get_config()),this.helper.debugLog(this.localizedData.dbg,{event:"page_view",data:this.get_config()},"Fired in Browser (ga-Page)"),this.pixelLoaded=!0)}get_dimensions(){var e={dimension1:"event_hour",dimension2:"event_day",dimension3:"event_month",dimension4:"dynx_itemid",dimension5:"dynx_pagetype",dimension6:"dynx_totalvalue"};return e}get_config(){var e={link_attribution:!1,anonymize_ip:!0,custom_map:this.get_dimensions(),debug_mode:"1"===this.localizedData.debug},t=this.get_storedCampaign();return t&&(void 0!==t.referrer&&(e.page_referrer=t.referrer),void 0!==t.location&&(e.page_location=t.location),void 0!==t.page&&(e.page_path=t.page)),e}fireData(e,t){if(this.isEnabled("b")&&this.pixelLoaded)switch(e){case"Event":gtag("event",this.event.grabEventName(),this.get_data_custom()),this.helper.debugLog(this.localizedData.dbg,{event:this.event.grabEventName(),data:this.get_data_custom()},"Fired in Browser (ga-"+e+")");break;case"Time":gtag("event",this.helper.get_EventName(e,t.time),this.get_data_custom(["transaction_id"],{transaction_id:this.event.grabOrderId()+"-t"+t.time})),this.helper.debugLog(this.localizedData.dbg,{event:this.helper.get_EventName(e,t.time),data:this.get_data_custom(["transaction_id"],{transaction_id:this.event.grabOrderId()+"-t"+t.time})},"Fired in Browser (ga-"+e+")");break;case"Scroll":gtag("event",this.helper.get_EventName(e,t.percent),this.get_data_custom(["transaction_id"],{transaction_id:this.event.grabOrderId()+"-s"+t.percent})),this.helper.debugLog(this.localizedData.dbg,{event:this.helper.get_EventName(e,t.percent),data:this.get_data_custom(["transaction_id"],{transaction_id:this.event.grabOrderId()+"-s"+t.percent})},"Fired in Browser (ga-"+e+")");break;case"Click":gtag("event",this.helper.get_EventName(e,t.tag),this.get_data_custom(["transaction_id"],{transaction_id:this.event.grabOrderId()+"-b"+t.tag,buttonTag:t.tag})),this.helper.debugLog(this.localizedData.dbg,{event:this.helper.get_EventName(e,t.tag),data:this.get_data_custom(["transaction_id"],{transaction_id:this.event.grabOrderId()+"-b"+t.tag,buttonTag:t.tag})},"Fired in Browser (ga-"+e+")");break;case"Visibility":gtag("event",this.helper.get_EventName(e,t.tag),this.get_data_custom(["transaction_id"],{transaction_id:this.event.grabOrderId()+"-v"+t.tag,itemTag:t.tag})),this.helper.debugLog(this.localizedData.dbg,{event:this.helper.get_EventName(e,t.tag),data:this.get_data_custom(["transaction_id"],{transaction_id:this.event.grabOrderId()+"-v"+t.tag,itemTag:t.tag})},"Fired in Browser (ga-"+e+")")}}sendData(e,t){this.isEnabled("s")&&(!1!==this.cid&&(t.cid=this.cid),!1!==this.gclid&&(t.gclid=this.gclid),this.helper.send_ajax({event:this.event,type:"ga",handler:e,data:t},this.localizedData.dbg))}get_data_custom(e=[],t={}){var a,i={};for(a in(0<this.event.grabValue()||"purchase"===this.event.grabEventName())&&(i.value=this.event.grabValue(),i.currency="EUR"),""!==this.event.grabProdId()&&(i.items=[{id:this.event.grabProdId(),name:this.event.grabProdName(),quantity:1,price:this.event.grabValue(),brand:this.event.getBrandName()}]),this.event.getUtm()){var s=this.event.getUtm()[a];""!==s&&(i[a]=s)}i.transaction_id=this.event.grabOrderId(),i.non_interaction=!0,i.page_title=this.event.getPageName(),i.post_type="product",i.post_id=this.event.getPageId(),i.plugin="Wp-Sdtrk",i.event_url=this.event.getEventSource(),i.user_role="guest",i.event_time=this.event.getEventTimeHour(),i.event_day=this.event.getEventTimeDay(),i.event_month=this.event.getEventTimeMonth(),i.landing_page=this.event.getLandingPage(),i.send_to=this.localizedData.pid;for(var n=0;n<e.length;n++){var r=e[n];i.hasOwnProperty(r)&&delete i[r]}for(const[d,s]of Object.entries(t))i[d]=s;return i}set_storedCampaign(){var e;for(e of["gclid"]){this.helper.get_Param(e)&&this.helper.save_cookie("_cd",this.event.getEventUrl(),14,!0);break}var t=this.event.getEventSourceReferer();-1===t.indexOf(this.event.getEventDomain())&&""!==t&&this.helper.save_cookie("_rd",t,14,!0)}get_storedCampaign(){var e,t=this.helper.get_Cookie("_rd",!0),a=this.helper.get_Cookie("_cd",!0);return!(!t&&!a)&&(e={},t&&(e.referrer=t,this.helper.save_cookie("_rd","",0,!0)),a&&(e.location=a),e.page=this.event.getEventPath(),e)}get_Cid(){var e,t=this.helper.get_Cookie("_ga",!1);return t?(e=(t=this.helper.get_Cookie("_ga",!1)).match(/[0-9]+\.[0-9]+$/gm),Array.isArray(e)&&(e=e[0]),this.helper.save_cookie("_ga",t,90,!1),e):(t=+new Date+"."+parseInt(1e10*Math.random()),e="GA1.1."+(t=this.event.getUserFP()?this.event.getUserFP()+"."+this.event.getUserFP():t),this.helper.save_cookie("_ga",e,90,!1),t)}get_Gclid(){var e;return this.helper.get_Param("gclid")?(e=this.helper.get_Param("gclid"),this.helper.save_cookie("_gc",e,90,!1),e):this.helper.get_Cookie("_gc",!1)?(e=this.helper.get_Cookie("_gc",!1),this.helper.save_cookie("_gc",e,90,!1),e):""}}function wp_sdtrk_backload_ga_b(){if(void 0!==window.wp_sdtrk_engine_class){var e=window.wp_sdtrk_engine_class.get_catcher_ga();if(e.isOngoingBackload("b"))for(const t of window.wp_sdtrk_history)switch((data=t.split("_"))[0]){case"Page":e.catchPageHit(0);break;case"Time":e.catchTimeHit(data[1],0);break;case"Scroll":e.catchScrollHit(data[1],0);break;case"Click":e.catchClickHit(data[1],0);break;case"Visited":e.catchVisibilityHit(data[1],0)}}}function wp_sdtrk_backload_ga_s(){if(void 0!==window.wp_sdtrk_engine_class){var e=window.wp_sdtrk_engine_class.get_catcher_ga();if(e.isOngoingBackload("s"))for(const t of window.wp_sdtrk_history)switch((data=t.split("_"))[0]){case"Page":e.catchPageHit(1);break;case"Time":e.catchTimeHit(data[1],1);break;case"Scroll":e.catchScrollHit(data[1],1);break;case"Click":e.catchClickHit(data[1],1);break;case"Visited":e.catchVisibilityHit(data[1],1)}}}