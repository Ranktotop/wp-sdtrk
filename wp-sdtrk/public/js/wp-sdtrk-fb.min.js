class Wp_Sdtrk_Catcher_Fb{constructor(e,t){this.localizedData=wp_sdtrk_fb,this.event=e,this.helper=t,this.s_enabled=!1,this.b_enabled=!1,this.pixelLoaded=!1,this.fbc=!1,this.fbp=!1,this.validate()}validate(e=2){""!==this.localizedData.pid&&this.event&&(this.helper.isAdmin()?this.helper.debugLog(this.localizedData.dbg,{},"Skip because user is admin (fb)"):(2!==e&&0!==e||!1===this.helper.has_consent(this.localizedData.b_ci,this.localizedData.b_cs,this.event)||""===this.localizedData.b_e||(this.b_enabled=!0,this.loadPixel()),2!==e&&1!==e||!1===this.helper.has_consent(this.localizedData.s_ci,this.localizedData.s_cs,this.event)||""===this.localizedData.s_e||(this.s_enabled=!0),this.get_fbc()&&(this.fbc=this.get_fbc()),this.get_fbp()&&(this.fbp=this.get_fbp())))}isOngoingBackload(e){var t=!0,a=!1;return"b"!==e||(t=this.pixelLoaded)||(this.validate(0),a=this.pixelLoaded),"s"!==e||(t=this.isEnabled("s"))||(this.validate(1),a=this.isEnabled("s")),!1===t&&!0===a}isEnabled(e){switch(e){case"b":return this.b_enabled;case"s":return this.s_enabled}return!1}catchPageHit(e=2){0!==e&&2!==e||this.fireData("Page",{state:!0}),1!==e&&2!==e||this.sendData("Page",{state:!0}),this.catchEventHit(e)}catchEventHit(e=2){this.event.grabEventName()&&(0!==e&&2!==e||this.fireData("Event",{state:!0}),1!==e&&2!==e||this.sendData("Event",{state:!0}))}catchScrollHit(e,t=2){0!==t&&2!==t||this.fireData("Scroll",{percent:e}),1!==t&&2!==t||this.sendData("Scroll",{percent:e})}catchTimeHit(e,t=2){0!==t&&2!==t||this.fireData("Time",{time:e}),1!==t&&2!==t||this.sendData("Time",{time:e})}catchClickHit(e,t=2){0!==t&&2!==t||this.fireData("Click",{tag:e}),1!==t&&2!==t||this.sendData("Click",{tag:e})}catchVisibilityHit(e,t=2){0!==t&&2!==t||this.fireData("Visibility",{tag:e}),1!==t&&2!==t||this.sendData("Visibility",{tag:e})}loadPixel(){var e,t,a,i;this.isEnabled("b")&&!this.pixelLoaded&&(a=window,i=document,e="script",a.fbq||(t=a.fbq=function(){t.callMethod?t.callMethod.apply(t,arguments):t.queue.push(arguments)},a._fbq||(a._fbq=t),(t.push=t).loaded=!0,t.version="2.0",t.queue=[],(a=i.createElement(e)).async=!0,a.src="https://connect.facebook.net/en_US/fbevents.js",(i=i.getElementsByTagName(e)[0]).parentNode.insertBefore(a,i)),fbq("init",this.localizedData.pid,this.get_data_user()),this.pixelLoaded=!0)}fireData(e,t){if(this.isEnabled("b")&&this.pixelLoaded)switch(e){case"Page":fbq("track","PageView",this.get_data_custom(["value","currency"]),{eventID:this.event.grabOrderId()}),this.helper.debugLog(this.localizedData.dbg,{event:"PageView",data:this.get_data_custom(["value","currency"]),meta:{eventID:this.event.grabOrderId()}},"Fired in Browser (fb-"+e+")");break;case"Event":fbq("trackSingle",this.localizedData.pid,this.convert_eventname(this.event.grabEventName()),this.get_data_custom(),{eventID:this.event.grabOrderId()}),this.helper.debugLog(this.localizedData.dbg,{event:this.convert_eventname(this.event.grabEventName()),data:this.get_data_custom(),meta:{eventID:this.event.grabOrderId()}},"Fired in Browser (fb-"+e+")");break;case"Time":fbq("trackCustom",this.helper.get_EventName(e,t.time),this.get_data_custom(),{eventID:this.event.grabOrderId()+"-t"+t.time}),this.helper.debugLog(this.localizedData.dbg,{event:this.helper.get_EventName(e,t.time),data:this.get_data_custom(),meta:{eventID:this.event.grabOrderId()+"-t"+t.time}},"Fired in Browser (fb-"+e+")");break;case"Scroll":fbq("trackCustom",this.helper.get_EventName(e,t.percent),this.get_data_custom(),{eventID:this.event.grabOrderId()+"-s"+t.percent}),this.helper.debugLog(this.localizedData.dbg,{event:this.helper.get_EventName(e,t.percent),data:this.get_data_custom(),meta:{eventID:this.event.grabOrderId()+"-s"+t.percent}},"Fired in Browser (fb-"+e+")");break;case"Click":fbq("trackCustom",this.helper.get_EventName(e,t.tag),this.get_data_custom([],{buttonTag:t.tag}),{eventID:this.event.grabOrderId()+"-b"+t.tag}),this.helper.debugLog(this.localizedData.dbg,{event:this.helper.get_EventName(e,t.tag),data:this.get_data_custom([],{buttonTag:t.tag}),meta:{eventID:this.event.grabOrderId()+"-b"+t.tag}},"Fired in Browser (fb-"+e+")");break;case"Visibility":fbq("trackCustom",this.helper.get_EventName(e,t.tag),this.get_data_custom([],{itemTag:t.tag}),{eventID:this.event.grabOrderId()+"-v"+t.tag}),this.helper.debugLog(this.localizedData.dbg,{event:this.helper.get_EventName(e,t.tag),data:this.get_data_custom([],{itemTag:t.tag}),meta:{eventID:this.event.grabOrderId()+"-v"+t.tag}},"Fired in Browser (fb-"+e+")")}}sendData(e,t){this.isEnabled("s")&&(!1!==this.fbc&&(t.fbc=this.fbc),!1!==this.fbp&&(t.fbp=this.fbp),this.helper.send_ajax({event:this.event,type:"fb",handler:e,data:t},this.localizedData.dbg))}get_data_custom(e=[],t={}){var a,i={};for(a in(0<this.event.grabValue()||"Purchase"===this.convert_eventname(this.event.grabEventName()))&&(i.currency="EUR",i.value=this.event.grabValue()),""!==this.event.grabProdId()&&(i.content_ids='["'+this.event.grabProdId()+'"]',i.content_type="product",i.content_name=this.event.grabProdName(),i.contents='[{"id":"'+this.event.grabProdId()+'","quantity":1}]'),this.event.getUtm()){var s=this.event.getUtm()[a];""!==s&&(i[a]=s)}for(var r=0;r<e.length;r++){var h=e[r];i.hasOwnProperty(h)&&delete i[h]}for(const[n,s]of Object.entries(t))i[n]=s;return i}get_data_user(){var e={};return""!==this.event.getUserFirstName()&&(e.fn=this.event.getUserFirstName()),""!==this.event.getUserLastName()&&(e.ln=this.event.getUserLastName()),""!==this.event.getUserEmail()&&(e.em=this.event.getUserEmail()),e}convert_eventname(e){switch(e){case"page_view":return"PageView";case"view_item":return"ViewContent";case"generate_lead":return"Lead";case"sign_up":return"CompleteRegistration";case"add_to_cart":return"AddToCart";case"begin_checkout":return"InitiateCheckout";case"purchase":return"Purchase";default:return!1}}get_fbp(){if(this.helper.get_Cookie("_fbp",!1))return e=this.helper.get_Cookie("_fbp",!1),this.helper.save_cookie("_fbp",e,90,!1),e;var e="fb.1."+ +new Date+"."+parseInt(1e10*Math.random());return this.helper.save_cookie("_fbp",e,90,!1),e}get_fbc(){var e;return this.helper.get_Param("fbclid")?(e="fb.1."+ +new Date+"."+this.helper.get_Param("fbclid"),this.helper.save_cookie("_fbc",e,90,!1),e):this.helper.get_Cookie("_fbc",!1)?(e=this.helper.get_Cookie("_fbc",!1),this.helper.save_cookie("_fbc",e,90,!1),e):""}}function wp_sdtrk_backload_fb_b(){if(void 0!==window.wp_sdtrk_engine_class){var e=window.wp_sdtrk_engine_class.get_catcher_fb();if(e.isOngoingBackload("b"))for(const t of window.wp_sdtrk_history)switch((data=t.split("_"))[0]){case"Page":e.catchPageHit(0);break;case"Time":e.catchTimeHit(data[1],0);break;case"Scroll":e.catchScrollHit(data[1],0);break;case"Click":e.catchClickHit(data[1],0);break;case"Visited":e.catchVisibilityHit(data[1],0)}}}function wp_sdtrk_backload_fb_s(){if(void 0!==window.wp_sdtrk_engine_class){var e=window.wp_sdtrk_engine_class.get_catcher_fb();if(e.isOngoingBackload("s"))for(const t of window.wp_sdtrk_history)switch((data=t.split("_"))[0]){case"Page":e.catchPageHit(1);break;case"Time":e.catchTimeHit(data[1],1);break;case"Scroll":e.catchScrollHit(data[1],1);break;case"Click":e.catchClickHit(data[1],1);break;case"Visited":e.catchVisibilityHit(data[1],1)}}}